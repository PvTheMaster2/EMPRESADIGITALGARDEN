<aside class="page-sidebar">
  <!-- Tags da página -->
  {% if tags and tags.length > 0 %}
  <section class="tags-section">
    <h3 class="sidebar-title">
      <span class="sidebar-icon">🏷️</span>
      Tags
    </h3>
    <div class="tags-list">
      {% for tag in tags %}
        {% if tag != 'template' and tag != 'all' %}
        <a href="/tags/{{ tag | slugify }}/" class="tag tag-{{ tag | slugify }}">{{ tag }}</a>
        {% endif %}
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <!-- Backlinks automáticos -->
  {% set currentUrl = page.url %}
  {% set currentTitle = title %}
  {% set autoBacklinks = [] %}
  
  {% for item in collections.all %}
    {% if item.url != currentUrl and item.templateContent %}
      {% set content = item.templateContent | striptags %}
      {% if content.includes(currentTitle) or content.includes(page.fileSlug) %}
        {% set autoBacklinks = (autoBacklinks.push(item), autoBacklinks) %}
      {% endif %}
    {% endif %}
  {% endfor %}
  
  {% if autoBacklinks.length > 0 %}
  <section class="backlinks-section">
    <h3 class="sidebar-title">
      <span class="sidebar-icon">🔗</span>
      Referenciado em
    </h3>
    <ul class="backlinks-list">
      {% for link in autoBacklinks %}
      <li class="backlink-item">
        <a href="{{ link.url }}" class="backlink-link">
          {{ link.data.title or link.fileSlug }}
        </a>
        {% if link.data.type %}
        <span class="backlink-type">{{ link.data.type }}</span>
        {% endif %}
      </li>
      {% endfor %}
    </ul>
  </section>
  {% endif %}

  <!-- Metadados da página -->
  <section class="page-meta-section">
    <h3 class="sidebar-title">
      <span class="sidebar-icon">📊</span>
      Metadados
    </h3>
    <div class="meta-list">
      {% if date %}
      <div class="meta-item">
        <span class="meta-label">Criado:</span>
        <span class="meta-value">{{ date | date("dd/MM/yyyy") }}</span>
      </div>
      {% endif %}
      
      {% if modified %}
      <div class="meta-item">
        <span class="meta-label">Modificado:</span>
        <span class="meta-value">{{ modified | date("dd/MM/yyyy") }}</span>
      </div>
      {% endif %}
      
      {% if page.inputPath %}
      <div class="meta-item">
        <span class="meta-label">Arquivo:</span>
        <span class="meta-value">{{ page.inputPath | replace('./', '') }}</span>
      </div>
      {% endif %}
      
      {% if content %}
      <div class="meta-item">
        <span class="meta-label">Palavras:</span>
        <span class="meta-value">{{ content | wordcount }}</span>
      </div>
      {% endif %}
    </div>
  </section>
</aside>
